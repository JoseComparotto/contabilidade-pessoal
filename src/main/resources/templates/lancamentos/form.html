<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: commonHead(${mode} == 'edit' ? 'Editar Lancamento' : 'Nova Lancamento')}"></head>

<body>
    <div th:replace="~{fragments/toast :: toasts}"></div>
    <main class="container">
        <h1 th:text="${mode} == 'edit' ? 'Editar Lancamento' : 'Novo Lancamento'"></h1>

        <div class="controls" style="margin-bottom:1rem">
            <a th:href="${mode == 'create'} ? @{${redirectUrl}} : @{/lancamentos/{id}(id=${lancamento.id})}">←
                Voltar</a>
        </div>

        <div class="form-card">
            <!-- Create mode uses ContaNewDto; Edit mode uses ContaViewDto -->
            <form th:action="${mode} == 'edit' ? @{/lancamentos/{id}/edit(id=${lancamento.id})} : @{/lancamentos}"
                method="post" th:with="
                    canEditDescricao=${mode == 'edit' ? lancamento.editable : true},
                    canEditDataCompetencia=${mode == 'edit' ? lancamento.editable : true},
                    canEditValor=${mode == 'edit' ? lancamento.editable : true},
                    canEditContaDebito=${mode == 'edit' ? lancamento.editable : true},
                    canEditContaCredito=${mode == 'edit' ? lancamento.editable : true},
                    canEditStatus=${mode == 'edit' ? lancamento.editable : true}
                ">
                <input type="hidden" name="redirect"
                    th:value="${mode == 'create'} ? @{${redirectUrl}} : @{/lancamentos/{id}(id=${lancamento.id})}" />
                <div class="form-grid">

                    <!-- Conta de Crédito (de) -->
                    <div th:replace="~{fragments/form-controls :: selectField(
                        'contaCreditoId', 'contaCreditoId', 'De: (Conta de Origem)', ${contasCredito}, ${lancamento.contaCreditoId},
                        true, ${not canEditContaCredito}, 'Selecione…', null, true)
                    }"></div>

                    <!-- Conta de Débito (para) -->
                    <div th:replace="~{fragments/form-controls :: selectField(
                        'contaDebitoId', 'contaDebitoId', 'Para: (Conta de Destino)', ${contasDebito}, ${lancamento.contaDebitoId},
                        true, ${not canEditContaDebito}, 'Selecione…', null, true)
                    }"></div>

                    <!-- Descrição -->
                    <div th:replace="~{fragments/form-controls :: textField(
                        'descricao', 'descricao', 'Descrição', ${lancamento.descricao},
                        true, ${not canEditDescricao}, null, true)
                    }"></div>

                    <!-- Valor -->
                    <div th:replace="~{fragments/form-controls :: moneyField(
                        'valor', 'valor', 'Valor', ${lancamento.valor}, 'R$',
                        true, ${not canEditValor}, null, true, 2)
                    }"></div>

                    <!-- Data de Competência -->
                    <div th:replace="~{fragments/form-controls :: dateField(
                        'dataCompetencia', 'dataCompetencia', 'Data', ${lancamento.dataCompetencia},
                        true, ${not canEditDataCompetencia}, null, true)
                    }"></div>

                    <!-- Status -->
                    <div th:replace="~{fragments/form-controls :: segmentedEnum(
                        'status', 'Status', ${statusList}, ${lancamento.status != null ? lancamento.status.name() : null}, 'StatusLancamento.',
                        true, ${not canEditStatus}, null, true)
                    }"></div>


                </div>

                <div
                    th:replace="~{fragments/form-controls :: formActions(${mode} == 'edit' ? 'Salvar' : 'Criar', ${mode == 'create'} ? @{${redirectUrl}} : @{/lancamentos/{id}(id=${lancamento.id})})}">
                </div>
            </form>
        </div>
    </main>

    <script src="/js/money.js"></script>
</body>

</html>